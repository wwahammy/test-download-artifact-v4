on:
  workflow_dispatch:
    inputs:
      kind:
        type: choice
        options:
          - "PATCH"
          - "MINOR"
          - "MAJOR"
        default: "PATCH"
        description: The type of version to create
      
permissions: 
  contents: write

jobs:
  tweak-version:
    runs-on: ubuntu-latest
    steps:
      - name: Parser
        id: parser
        run: |
          REF='${{ github.ref }}'
          if [[ $REF == refs/tags/v* ]]; then
            VERSION=${REF#refs/tags/v}
          else
            echo "No idea how to decipher this ref: $REF"
            exit 1
          fi 
          echo "version=$VERSION" >> $GITHUB_OUTPUT

      - name: Update Semantic Version
        uses: cookbenjamin/update-version@v1.0.1
        with:
          current-version: "${{steps.parser.outputs.version}}"
          prerelease-fragment: "REMOVE"
          increment-version-fragment: ${{ inputs.kind }}
        id: version-creator
      - name: tag the new version
        run: |
          git tag v${{ steps.version-creator.outputs.next-version}}
          git push origin v${{ steps.version-creator.outputs.next-version}}


